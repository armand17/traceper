function TrackerOperator(e,t,r,s,i){TRACKER=this,MAP=t,this.langOperator,this.userId,this.preUserId=-1,this.language="en",this.ajaxUrl=e,this.facebookId=null,this.fetchPhotosInInitialization=Number(r),this.updateFriendListPageNo=1,this.updateFriendListPageCount=0,this.pastPointsPageNo=0,this.bgImageListPageNo=1,this.bgImageListPageCount=0,this.pastPointsPageCount=null,this.updateInterval=s,this.timer,this.imageTimer,this.traceLineDrawedUserId=null,this.showImagesOnTheMap=!0,this.showUsersOnTheMap=!1,this.showImagesOnTheMapJustToggled=!1,this.queryUpdatedUserInterval=i,this.getUserListInterval=s,this.friendPageResetCount=Number(0),this.users=[],this.geofences=[],this.allImagesFetched=!1,this.images=[],this.imageIds=[],this.imageThumbSuffix,this.imageOrigSuffix,this.User=function(){for(var e in arguments[0])this[e]=arguments[0][e]},this.Img=function(){for(var e in arguments[0])this[e]=arguments[0][e]},this.setLangOperator=function(e){TRACKER.langOperator=e},this.updateFriendListWithDeletion=function(e){MAP.setMarkerVisible(TRACKER.users[e].mapMarker[0].marker,!1),TRACKER.users[e].infoWindowIsOpened&&MAP.closeInfoWindow(TRACKER.users[e].mapMarker[0].infoWindow),TRACKER.preUserId==e&&(TRACKER.preUserId=-1),delete TRACKER.users[e]},this.updateImageListWithDeletion=function(e){MAP.setMarkerVisible(TRACKER.images[e].mapMarker.marker,!1),TRACKER.images[e].infoWindowIsOpened&&MAP.closeInfoWindow(TRACKER.images[e].mapMarker.infoWindow),delete TRACKER.images[e]};var a={getUserListJson:0,getPublicUploadListJson:0,getUploadListJson:0,getUserPastPointsJSON:0,sendGeofenceData:0};this.getFriendList=function(e,t,r,s){var i;i="undefined"!=typeof t?"r=users/getUserListJson&pageNo="+TRACKER.updateFriendListPageNo+"&userType="+t:"r=users/getUserListJson&pageNo="+TRACKER.updateFriendListPageNo+"&userType=0",TRACKER.friendPageResetCount>0&&(i+="&list=onlyUpdated"),"undefined"!=typeof r&&(i+="&newFriendId="+r),TRACKER.ajaxReq(i,function(o){try{"undefined"!=typeof s?processUsers(MAP,o.userlist,o.currentUser,o.updateType,s):processUsers(MAP,o.userlist,o.currentUser,o.updateType),TRACKER.updateFriendListPageNo=o.pageNo,TRACKER.updateFriendListPageCount=o.pageCount;{TRACKER.updateInterval}if(TRACKER.updateFriendListPageNo>=TRACKER.updateFriendListPageCount?(TRACKER.updateFriendListPageNo=1,TRACKER.friendPageResetCount=Number(TRACKER.friendPageResetCount)+1):(TRACKER.updateFriendListPageNo++,TRACKER.updateInterval=TRACKER.getUserListInterval),clearTimeout(TRACKER.timer),TRACKER.timer=setTimeout(function(){TRACKER.getFriendList(e,t)},TRACKER.updateInterval),a.getUserListJson>5){var n="r=site/ajaxEmailNotification&title=Javascript Exception Recovered&message=User Info: </br></br>User Browser: "+BrowserDetect.browser+" "+BrowserDetect.version+"</br>User OS: "+BrowserDetect.OS+"</br></br>'getUserListJson' javascript exception is recovered at "+a.getUserListJson+". trial.</br>&params=getUserListJsonRecovery";TRACKER.ajaxReq(n,null,!0)}a.getUserListJson=0}catch(R){if(alertMsg("Exception in jsonparams: "+i+"\nError: "+R.message+"\nJSON obj: "+JSON.stringify(o)),a.getUserListJson=a.getUserListJson+1,a.getUserListJson<5)clearTimeout(TRACKER.timer),TRACKER.timer=setTimeout(function(){TRACKER.getFriendList(e,t,r,s)},1e3);else if(5==a.getUserListJson){var n="r=site/ajaxEmailNotification&title=Javascript Exception Occured!&message=Exception Info: </br></br>User Browser: "+BrowserDetect.browser+" "+BrowserDetect.version+"</br>User OS: "+BrowserDetect.OS+"</br></br>Exception in jsonparams: "+i+"</br>Error: "+R.message+"</br>JSON obj: "+JSON.stringify(o)+"&params=getUserListJson";TRACKER.ajaxReq(n,null,!0)}else clearTimeout(TRACKER.timer),TRACKER.timer=setTimeout(function(){TRACKER.getFriendList(e,t,r,s)},1e4)}},!0)},this.getImageList=function(e,t,r){var s,i;"undefined"!=typeof e&&1==e?(s="r=upload/getPublicUploadListJson&pageNo="+TRACKER.bgImageListPageNo+"&fileType=0",i="getPublicUploadListJson"):(s="r=upload/getUploadListJson&pageNo="+TRACKER.bgImageListPageNo+"&fileType=0",i="getUploadListJson"),"undefined"!=typeof t&&1==t?(TRACKER.bgImageListPageNo=1,TRACKER.allImagesFetched=!1):1==TRACKER.allImagesFetched&&(s+="&list=onlyUpdated"),TRACKER.showImagesOnTheMapJustToggled=!1,TRACKER.ajaxReq(s,function(o){try{if(TRACKER.bgImageListPageNo=o.pageNo,TRACKER.bgImageListPageCount=o.pageCount,processUploads(MAP,o.deletedlist,o.uploadlist,o.updateType,o.thumbSuffix),TRACKER.bgImageListPageNo<TRACKER.bgImageListPageCount?(TRACKER.bgImageListPageNo=Number(TRACKER.bgImageListPageNo)+1,clearTimeout(TRACKER.imageTimer),TRACKER.imageTimer=setTimeout(function(){TRACKER.getImageList(e,!1)},TRACKER.getUserListInterval)):(TRACKER.bgImageListPageNo=1,TRACKER.allImagesFetched=!0,clearTimeout(TRACKER.imageTimer),TRACKER.imageTimer=setTimeout(function(){TRACKER.getImageList(e,!1)},TRACKER.queryUpdatedUserInterval)),"function"==typeof r&&r(),a[i]>5){var n="r=site/ajaxEmailNotification&title=Javascript Exception Recovered&message=User Info: </br></br>User Browser: "+BrowserDetect.browser+" "+BrowserDetect.version+"</br>User OS: "+BrowserDetect.OS+"</br></br>"+i+" javascript exception is recovered at "+a[i]+". trial.</br>&params="+i+"Recovery";TRACKER.ajaxReq(n,null,!0)}a[i]=0}catch(R){if(alertMsg("Exception in jsonparams: "+s+"\nError: "+R.message+"\nJSON obj: "+JSON.stringify(o)),a[i]=a[i]+1,a[i]<5)clearTimeout(TRACKER.imageTimer),TRACKER.imageTimer=setTimeout(function(){TRACKER.getImageList(e,t,r)},1e3);else if(5==a[i]){var n="r=site/ajaxEmailNotification&title=Javascript Exception Occured!&message=Exception Info: </br></br>User Browser: "+BrowserDetect.browser+" "+BrowserDetect.version+"</br>User OS: "+BrowserDetect.OS+"</br></br>Exception in jsonparams: "+s+"</br>Error: "+R.message+"</br>JSON obj: "+JSON.stringify(o)+"&params="+i;TRACKER.ajaxReq(n,null,!0)}else clearTimeout(TRACKER.imageTimer),TRACKER.imageTimer=setTimeout(function(){TRACKER.getImageList(e,t,r)},1e4)}},!0)},this.trackUser=function(e){if("undefined"==typeof TRACKER.users[e]){alertMsg("Id:"+e+" is undefined");var t="r=users/getUserInfoJSON&userId="+e+"&";TRACKER.ajaxReq(t,function(t){processUsers(MAP,t),"undefined"!=typeof TRACKER.users[e]?TRACKER.trackUser(e):TRACKER.users[e]=null},!0)}else if(null!==TRACKER.users[e]&&"1"==TRACKER.users[e].friendshipStatus&&""!=TRACKER.users[e].latitude&&""!=TRACKER.users[e].longitude){var r=new MapStruct.Location({latitude:TRACKER.users[e].latitude,longitude:TRACKER.users[e].longitude});MAP.panMapTo(r),-1!=TRACKER.preUserId&&("undefined"==typeof TRACKER.users[TRACKER.preUserId]||"undefined"==TRACKER.users[TRACKER.preUserId]||(MAP.closeInfoWindow(TRACKER.users[TRACKER.preUserId].mapMarker[0].infoWindow),TRACKER.users[TRACKER.preUserId].infoWindowIsOpened=!1)),MAP.openInfoWindow(TRACKER.users[e].mapMarker[0].infoWindow,TRACKER.users[e].mapMarker[0].marker),TRACKER.users[e].infoWindowIsOpened=!0,TRACKER.preUserId=e}else alertMsg("else, TRACKER.users[userId]:"+TRACKER.users[e])},this.drawTraceLine=function(e,t,r){if(null!=TRACKER.traceLineDrawedUserId&&e!=TRACKER.traceLineDrawedUserId&&"undefined"!=typeof TRACKER.users[TRACKER.traceLineDrawedUserId].polyline&&TRACKER.clearTraceLines(TRACKER.traceLineDrawedUserId),"undefined"==typeof TRACKER.users[e].polyline||t>TRACKER.pastPointsPageNo){t>TRACKER.pastPointsPageCount;var s="r=users/getUserPastPointsJSON&userId="+e+"&page="+t;TRACKER.ajaxReq(s,function(i){try{TRACKER.pastPointsPageNo=i.pageNo,TRACKER.pastPointsPageCount=i.pageCount;{processUserPastLocations(MAP,i.userwashere,e)}if("function"==typeof r&&r(),a.getUserPastPointsJSON>5){var o="r=site/ajaxEmailNotification&title=Javascript Exception Recovered&message=User Info: </br></br>User Browser: "+BrowserDetect.browser+" "+BrowserDetect.version+"</br>User OS: "+BrowserDetect.OS+"</br></br>'getUserPastPointsJSON' javascript exception is recovered at "+a.getUserPastPointsJSON+". trial.</br>&params=getUserPastPointsJSONRecovery";TRACKER.ajaxReq(o,null,!0)}a.getUserPastPointsJSON=0}catch(n){if(alertMsg("Exception in jsonparams: "+s+"\nError: "+n.message+"\nJSON obj: "+JSON.stringify(i)),a.getUserPastPointsJSON=a.getUserPastPointsJSON+1,a.getUserPastPointsJSON<5)setTimeout(function(){TRACKER.drawTraceLine(e,t,r)},1e3);else if(5==a.getUserPastPointsJSON){var o="r=site/ajaxEmailNotification&title=Javascript Exception Occured!&message=Exception Info: </br></br>User Browser: "+BrowserDetect.browser+" "+BrowserDetect.version+"</br>User OS: "+BrowserDetect.OS+"</br></br>Exception in jsonparams: "+s+"</br>Error: "+n.message+"</br>JSON obj: "+JSON.stringify(i)+"&params=getUserPastPointsJSON";TRACKER.ajaxReq(o,null,!0)}else setTimeout(function(){TRACKER.drawTraceLine(e,t,r)},1e4)}},!0)}else{MAP.setPolylineVisibility(TRACKER.users[e].polyline,!0);for(var i in TRACKER.users[e].mapMarker)null!=TRACKER.users[e].mapMarker[i].marker&&MAP.setMarkerVisible(TRACKER.users[e].mapMarker[i].marker,!0)}TRACKER.traceLineDrawedUserId=e},this.clearTraceLines=function(e){if("undefined"!=typeof TRACKER.users[e].polyline){MAP.setPolylineVisibility(TRACKER.users[e].polyline,!1);for(var t=TRACKER.users[e].mapMarker.length,r=1;t>r;r++)null!=TRACKER.users[e].mapMarker[r].marker&&(MAP.setMarkerVisible(TRACKER.users[e].mapMarker[r].marker,!1),MAP.closeInfoWindow(TRACKER.users[e].mapMarker[r].infoWindow),TRACKER.users[e].infoWindowIsOpened=!1)}},this.sendGeoFencePoints=function(e,t,r,s,i,a,o,n){var R=!0,u="r=geofence/sendGeofenceData&name="+e+"&description="+t+"&point1Latitude="+r.toFixed(6)+"&point1Longitude="+s.toFixed(6)+"&point2Latitude="+i.toFixed(6)+"&point2Longitude="+a.toFixed(6)+"&point3Latitude="+o.toFixed(6)+"&point3Longitude="+n.toFixed(6);return TRACKER.ajaxReq(u,function(e){try{e.result&&"1"==e.result||(R=!1,TRACKER.showMessageDialog("A geofence with this name already exists!"))}catch(t){alertMsg("Exception in jsonparams: "+jsonparams+"\nError: "+t.message+"\nJSON obj: "+JSON.stringify(e))}},!0),R},this.showMediaWindow=function(e,t){"undefined"==typeof TRACKER.images[e]?TRACKER.getImageList(t,!0,function(){MAP.trigger(TRACKER.images[e].mapMarker.marker,"click")}):MAP.trigger(TRACKER.images[e].mapMarker.marker,"click")},this.closeMarkerInfoWindow=function(e){TRACKER.users[e].gmarker.closeInfoWindow(),TRACKER.users[e].infoWindowIsOpened=!1},this.zoomPoint=function(e,t){var r=new MapStruct.Location({latitude:e,longitude:t});MAP.zoomPoint(r)},this.zoomOutPoint=function(e,t){var r=new MapStruct.Location({latitude:e,longitude:t});MAP.zoomOutPoint(r)},this.zoomMaxPoint=function(e,t){var r=new MapStruct.Location({latitude:e,longitude:t});MAP.zoomMaxPoint(r)},this.showPointGMarkerInfoWin=function(e,t,r){if("undefined"==typeof TRACKER.users[r].mapMarker||"undefined"==typeof TRACKER.users[r].mapMarker[t]){"1"==t&&(TRACKER.pastPointsPageNo=0);var s=Number(TRACKER.pastPointsPageNo)+1;null==TRACKER.pastPointsPageCount||s<=TRACKER.pastPointsPageCount?TRACKER.drawTraceLine(r,s,function(){"undefined"==typeof TRACKER.users[r].mapMarker[t]?TRACKER.users[r].mapMarker[t]=null:(MAP.closeInfoWindow(TRACKER.users[r].mapMarker[e].infoWindow),TRACKER.users[r].infoWindowIsOpened=!1,MAP.trigger(TRACKER.users[r].mapMarker[t].marker,"click"))}):TRACKER.showInfoBar(TRACKER.langOperator.noMorePastDataAvailable)}else null==TRACKER.users[r].mapMarker[t]?TRACKER.showInfoBar(TRACKER.langOperator.noMorePastDataAvailable):("1"==t&&(t=0),r!=TRACKER.traceLineDrawedUserId&&TRACKER.drawTraceLine(r),"undefined"!=typeof TRACKER.users[r].polyline&&MAP.setPolylineVisibility(TRACKER.users[r].polyline,!0),MAP.closeInfoWindow(TRACKER.users[r].mapMarker[e].infoWindow),TRACKER.users[r].infoWindowIsOpened=!1,MAP.trigger(TRACKER.users[r].mapMarker[t].marker,"click"))};var o={};this.ajaxReq=function(e,t,r){$.ajax({url:TRACKER.ajaxUrl,type:"POST",data:e,dataType:"json",timeout:1e5,beforeSend:function(){},success:function(r){t(r),o[e]=0},statusCode:{400:function(){},401:function(){},403:function(){},404:function(){},406:function(){},408:function(){},500:function(){},503:function(){}},error:function(s,i,a){if(200!=s.status,403==s.status){if(alertMsg("403 Forbidden: Forbidden, authorization required!"),bDeploymentModeOn===!0){var n="r=site/ajaxEmailNotification&title=Ajax Error Occured!&message=Error Info: </br></br>User Browser: "+BrowserDetect.browser+" "+BrowserDetect.version+"</br>User OS: "+BrowserDetect.OS+"</br></br>xhr.responseText: "+s.responseText+"</br>xhr.status: "+s.status+"</br>error: "+a+"</br>Error in ajax - ajaxUrl:"+TRACKER.ajaxUrl+" - params:"+e+"&params="+e;TRACKER.ajaxReq(n,null,!0)}}else if(o[e]||(o[e]=0),o[e]=o[e]+1,o[e]>5){var n="r=site/ajaxEmailNotification&title=Ajax Error Occured!&message=Error Info: </br></br>User Browser: "+BrowserDetect.browser+" "+BrowserDetect.version+"</br>User OS: "+BrowserDetect.OS+"</br></br>xhr.responseText: "+s.responseText+"</br>xhr.status: "+s.status+"</br>error: "+a+"</br>Error in ajax - ajaxUrl:"+TRACKER.ajaxUrl+" - params:"+e+"&params="+e;TRACKER.ajaxReq(n,null,!0),location.reload()}else setTimeout(function(){TRACKER.ajaxReq(e,t,r)},1e3)}})},this.getPageNo=function(e){return $(e).find("page").attr("pageNo")},this.getPageCount=function(e){return $(e).find("page").attr("pageCount")},this.showInfoBar=function(e){$("#infoBottomBar").text(e).slideDown("slow",function(){setTimeout(function(){$("#infoBottomBar").slideUp("slow")},1e3)})},this.showMessageDialog=function(e){$("#messageDialogOK").show(),$("#messageDialogText").html("</br>"+e),$("#messageDialog").dialog("open")},this.showLongMessageDialog=function(e,t){$("#longMessageDialogOK").show(),$("#longMessageDialogText").html("</br>"+e),$("#longMessageDialogOKButton").unbind("click"),"undefined"!=typeof t&&$("#longMessageDialogOKButton").click(function(){location.href=t}),$("#longMessageDialog").dialog("open")},this.showConfirmationDialog=function(e,t){$("#confirmationDialogButtons").show(),$("#confirmationDialog #question").html("</br>"+e),$("#confirmationDialogOK").unbind("click"),$("#confirmationDialogOK").click(function(){t()}),$("#confirmationDialog").dialog("open")},this.closeConfirmationDialog=function(){$("#confirmationDialog").dialog("close")}}