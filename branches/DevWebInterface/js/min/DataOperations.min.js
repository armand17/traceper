function processUserPastLocations(e,i,a){var r=[],s=[];if($.each(i,function(i,n){var o=n.latitude,t=n.longitude,R=(n.altitude,n.time),d=n.deviceId,l=n.userType,p=new MapStruct.Location({latitude:o,longitude:t});r.push(p);var m=e.putMarker(p),u=e.initializeInfoWindow(),f=new MapStruct.MapMarker({marker:m,infoWindow:u});e.setMarkerClickListener(m,function(){var i=TRACKER.users[a].mapMarker.indexOf(f),r=i+1,s=i-1,n="";1==l&&(n=TRACKER.langOperator.deviceId+": "+d);var p="<div><b>"+TRACKER.users[a].realname+"</b> "+TRACKER.langOperator.wasHere+"<br/>"+TRACKER.langOperator.time+": "+R+"<br/>"+o+", "+t+n+'</div><ul class="sf-menu"> <li><a class="infoWinOperations" href="javascript:TRACKER.showPointGMarkerInfoWin('+i+","+r+","+a+')">'+TRACKER.langOperator.previousPoint+"</a></li><li><a href='#' class='infoWinOperations'>"+TRACKER.langOperator.operations+'</a><ul><li><a class="infoWinOperations" href="javascript:TRACKER.zoomPoint('+o+","+t+')">'+TRACKER.langOperator.zoom+'</a></li><li><a class="infoWinOperations" href="javascript:TRACKER.zoomMaxPoint('+o+","+t+')">'+TRACKER.langOperator.zoomMax+'</a></li><li><a class="infoWinOperations" href="javascript:TRACKER.clearTraceLines('+a+')">'+TRACKER.langOperator.clearTraceLines+'</a></li></ul></li><li><a class="infoWinOperations" href="javascript:TRACKER.showPointGMarkerInfoWin('+i+","+s+","+a+')">'+TRACKER.langOperator.nextPoint+"</a></li></ul>";e.setContentOfInfoWindow(TRACKER.users[a].mapMarker[i].infoWindow,p),e.openInfoWindow(TRACKER.users[a].mapMarker[i].infoWindow,TRACKER.users[a].mapMarker[i].marker),TRACKER.users[a].infoWindowIsOpened=!0}),s.push(f)}),"undefined"==typeof TRACKER.users[a].polyline){var n=new MapStruct.Location({latitude:TRACKER.users[a].latitude,longitude:TRACKER.users[a].longitude});TRACKER.users[a].polyline=e.initializePolyline(),e.addPointToPolyline(TRACKER.users[a].polyline,n)}var o,t=r.length;for(o=0;t>o;o++)e.addPointToPolyline(TRACKER.users[a].polyline,r[o]);var R=TRACKER.users[a].mapMarker;TRACKER.users[a].mapMarker=R.concat(s)}function getContentFor(e,i){var a='<div style="width:280px; height:180px;"><div><div style="display:inline-block;vertical-align:middle;"><img src="'+i+'" width="44px" height="48px"/></div><div style="display:inline-block;vertical-align:middle;padding-left:5px;cursor:text;"><b><font size="5">'+TRACKER.users[e].realname+'</font></b></div></div></br><div style="cursor:text;">'+TRACKER.users[e].time+" - ("+TRACKER.users[e].latitude+", "+TRACKER.users[e].longitude+')</div><div style="cursor:text;">'+TRACKER.users[e].address+'</div></br><div style="position:absolute;bottom:10px;"><a class="infoWinOperations med-icon-bordered-effect med-icon-effect-a" href="javascript:TRACKER.showPointGMarkerInfoWin(1,2,'+e+')"><div class="med-icon-bordered icon-arrow-left vtip" title="'+TRACKER.langOperator.previousPoint+'"></div></a><a class="infoWinOperations med-icon-effect med-icon-effect-a" style="margin-left:145px;" href="javascript:TRACKER.zoomPoint('+TRACKER.users[e].latitude+","+TRACKER.users[e].longitude+')"><div class="med-icon icon-zoomIn1 vtip" title="'+TRACKER.langOperator.zoom+'"></div></a><a class="infoWinOperations med-icon-effect med-icon-effect-a" href="javascript:TRACKER.zoomOutPoint('+TRACKER.users[e].latitude+","+TRACKER.users[e].longitude+')"><div class="med-icon icon-zoomOut1 vtip" title="'+TRACKER.langOperator.zoomOut+'"></div></a><a class="infoWinOperations med-icon-effect med-icon-effect-a" href="javascript:TRACKER.zoomMaxPoint('+TRACKER.users[e].latitude+","+TRACKER.users[e].longitude+')"><div class="med-icon icon-zoomMax5 vtip" title="'+TRACKER.langOperator.zoomMax+'"></div></a></div>';return a}function processUsers(e,i,a,r){var s="all";"undefined"!=typeof r&&(s=r);var n=new Array,o=!1;$.each(i,function(i,r){var s=r.user;n.push(s);var t=1,R=r.realname,d=r.latitude,l=r.longitude,p=r.address,m=r.calculatedTime,u=r.status_message,f=r.fb_id,c=r.profilePhotoStatus,T=r.time,C=r.message,A=r.deviceId,E=r.userType,K=new MapStruct.Location({latitude:d,longitude:l}),g=!1;"1"==t&&(g=!0);var v,k=(new Date).getTime();switch(c){case"0":v=0!=f&&"undefined"!=typeof f?'<img src="https://graph.facebook.com/'+f+'/picture?type=square" width="44px" height="48px" />':'<div class="hi-icon-in-list icon-user" style="color:#FFDB58; cursor:default;"></div>';break;case"1":case"3":v=s===a?'<img src="profilePhotos/'+s+".png?random="+k+'" />':'<img src="profilePhotos/'+s+'.png" />';break;case"2":v='<img src="https://graph.facebook.com/'+f+'/picture?type=square" width="44px" height="48px"/>';break;default:v='<div class="hi-icon-in-list icon-user" style="color:#FFDB58; cursor:default;"></div>'}if("undefined"==typeof TRACKER.users[s]){var h;switch(c){case"0":h=0!=f&&"undefined"!=typeof f?e.putMarker(K,"https://graph.facebook.com/"+f+"/picture?type=square",g,!0):e.putMarker(K,"images/person.png",g,!1);break;case"1":case"3":h=s===a?e.putMarker(K,"profilePhotos/"+s+".png?random="+k,g,!0):e.putMarker(K,"profilePhotos/"+s+".png",g,!0);break;case"2":h=e.putMarker(K,"https://graph.facebook.com/"+f+"/picture?type=square",g,!0);break;default:h=e.putMarker(K,"images/person.png",g,!1)}s===a&&(currentUserMarker=h),o=!0;var w=new MapStruct.MapMarker({marker:h});TRACKER.users[s]=new TRACKER.User({realname:R,latitude:d,longitude:l,address:p,friendshipStatus:t,time:T,message:C,status_message:u,deviceId:A,userType:E,mapMarker:new Array(w),locationCalculatedTime:m});var M='<div style="width:280px; height:180px;"><div><div style="display:inline-block;vertical-align:middle;">'+v+'</div><div style="display:inline-block;vertical-align:middle;padding-left:5px;cursor:text;"><b><font size="5">'+TRACKER.users[s].realname+'</font></b></div></div></br><div style="cursor:text;">'+TRACKER.users[s].time+" - ("+TRACKER.users[s].latitude+", "+TRACKER.users[s].longitude+')</div><div style="cursor:text;">'+TRACKER.users[s].address+'</div></br><div style="position:absolute;bottom:10px;"><a class="infoWinOperations med-icon-bordered-effect med-icon-effect-a" href="javascript:TRACKER.showPointGMarkerInfoWin(1,2,'+s+')"><div class="med-icon-bordered icon-arrow-left vtip" title="'+TRACKER.langOperator.previousPoint+'"></div></a><a class="infoWinOperations med-icon-effect med-icon-effect-a" style="margin-left:145px;" href="javascript:TRACKER.zoomPoint('+TRACKER.users[s].latitude+","+TRACKER.users[s].longitude+')"><div class="med-icon icon-zoomIn1 vtip" title="'+TRACKER.langOperator.zoom+'"></div></a><a class="infoWinOperations med-icon-effect med-icon-effect-a" href="javascript:TRACKER.zoomOutPoint('+TRACKER.users[s].latitude+","+TRACKER.users[s].longitude+')"><div class="med-icon icon-zoomOut1 vtip" title="'+TRACKER.langOperator.zoomOut+'"></div></a><a class="infoWinOperations med-icon-effect med-icon-effect-a" href="javascript:TRACKER.zoomMaxPoint('+TRACKER.users[s].latitude+","+TRACKER.users[s].longitude+')"><div class="med-icon icon-zoomMax5 vtip" title="'+TRACKER.langOperator.zoomMax+'"></div></a></div>';TRACKER.users[s].mapMarker[0].infoWindow=e.initializeInfoWindow(M),e.setMarkerClickListener(TRACKER.users[s].mapMarker[0].marker,function(){e.openInfoWindow(TRACKER.users[s].mapMarker[0].infoWindow,TRACKER.users[s].mapMarker[0].marker),TRACKER.users[s].infoWindowIsOpened=!0}),e.setMarkerVisible(TRACKER.users[s].mapMarker[0].marker,s==TRACKER.userId?!0:TRACKER.showUsersOnTheMap)}else{var y=T,A=A,E=E;if("1"==t&&""==TRACKER.users[s].latitude&&""==TRACKER.users[s].longitude&&e.setMarkerVisible(TRACKER.users[s].mapMarker[0].marker,s==TRACKER.userId?!0:TRACKER.showUsersOnTheMap),null!=TRACKER.users[s].mapMarker[0].infoWindow&&(TRACKER.users[s].latitude!=d||TRACKER.users[s].longitude!=l||TRACKER.users[s].time!=y)){var O=TRACKER.users[s].infoWindowIsOpened,M='<div style="width:280px; height:180px;"><div><div style="display:inline-block;vertical-align:middle;">'+v+'</div><div style="display:inline-block;vertical-align:middle;padding-left:5px;cursor:text;"><b><font size="5">'+R+'</font></b></div></div></br><div style="cursor:text;">'+y+" - ("+d+", "+l+')</div><div style="cursor:text;">'+p+'</div></br><div style="position:absolute;bottom:10px;"><a class="infoWinOperations med-icon-bordered-effect med-icon-effect-a" href="javascript:TRACKER.showPointGMarkerInfoWin(1,2,'+s+')"><div class="med-icon-bordered icon-arrow-left vtip" title="'+TRACKER.langOperator.previousPoint+'"></div></a><a class="infoWinOperations med-icon-effect med-icon-effect-a" style="margin-left:145px;" href="javascript:TRACKER.zoomPoint('+d+","+l+')"><div class="med-icon icon-zoomIn1 vtip" title="'+TRACKER.langOperator.zoom+'"></div></a><a class="infoWinOperations med-icon-effect med-icon-effect-a" href="javascript:TRACKER.zoomOutPoint('+d+","+l+')"><div class="med-icon icon-zoomOut1 vtip" title="'+TRACKER.langOperator.zoomOut+'"></div></a><a class="infoWinOperations med-icon-effect med-icon-effect-a" href="javascript:TRACKER.zoomMaxPoint('+d+","+l+')"><div class="med-icon icon-zoomMax5 vtip" title="'+TRACKER.langOperator.zoomMax+'"></div></a></div>';1==O&&(e.closeInfoWindow(TRACKER.users[s].mapMarker[0].infoWindow),e.setContentOfInfoWindow(TRACKER.users[s].mapMarker[0].infoWindow,M),e.openInfoWindow(TRACKER.users[s].mapMarker[0].infoWindow,TRACKER.users[s].mapMarker[0].marker))}TRACKER.users[s].latitude=d,TRACKER.users[s].longitude=l,TRACKER.users[s].time=y,TRACKER.users[s].locationCalculatedTime=m,TRACKER.users[s].deviceId=A,TRACKER.users[s].userType=E,TRACKER.users[s].friendshipStatus=t}});var t=!1;for(var R in TRACKER.users)"undefined"!=typeof TRACKER.users[R]&&null!==TRACKER.users[R]&&(e.setMarkerVisible(TRACKER.users[R].mapMarker[0].marker,R==TRACKER.userId?!0:TRACKER.showUsersOnTheMap),TRACKER.users[R].infoWindowIsOpened&&0==TRACKER.showUsersOnTheMap&&R!=TRACKER.userId&&e.closeInfoWindow(TRACKER.users[R].mapMarker[0].infoWindow),"all"===s&&-1===n.indexOf(R)&&(TRACKER.preUserId==R&&(TRACKER.preUserId=-1),e.setMarkerVisible(TRACKER.users[R].mapMarker[0].marker,!1),TRACKER.users[R].infoWindowIsOpened&&e.closeInfoWindow(TRACKER.users[R].mapMarker[0].infoWindow),delete TRACKER.users[R],t=!0));(t===!0||1==TRACKER.updateFriendListPageCount&&o===!0)&&("undefined"==typeof $.fn.yiiGridView||"undefined"==typeof $.fn.yiiGridView.settings.userListView||$.fn.yiiGridView.update("userListView")),delete n}function processUploads(e,i,a,r,s){var n="all";"undefined"!=typeof r&&(n=r),"undefined"!=typeof s&&(TRACKER.imageThumbSuffix=s);var o=!1;$.each(a,function(i,a){var r=a.id,s=decodeURIComponent(a.url),n=a.byRealName,t=a.byUserId,R=a.latitude,d=a.longitude,l=a.time,p=a.rating,m="",u=new MapStruct.Location({latitude:R,longitude:d});if(-1==$.inArray(r,TRACKER.imageIds)&&TRACKER.imageIds.push(r),"undefined"==typeof TRACKER.images[r]){o=!0,image=s+"&fileType=0&"+TRACKER.imageThumbSuffix;var f=e.putMarker(u,image,!1,!1),c=e.initializeInfoWindow(),T=new MapStruct.MapMarker({marker:f,infoWindow:c});TRACKER.images[r]=new TRACKER.Img({imageId:r,imageURL:s,userId:t,realname:n,latitude:R,longitude:d,time:l,rating:p,mapMarker:T,description:m}),e.setMarkerVisible(TRACKER.images[r].mapMarker.marker,TRACKER.showImagesOnTheMap),e.setMarkerClickListener(TRACKER.images[r].mapMarker.marker,function(){var i=new Image;i.src=TRACKER.images[r].imageURL+"&fileType=0",$(i).load(function(){var a="<div class='origImageContainer'><div><img src='"+i.src+"' height='"+i.height+"' width='"+i.width+"' class='origImage' /></div><div>"+TRACKER.images[r].description+"<br/><a href='javascript:TRACKER.trackUser("+TRACKER.images[r].userId+")' class='uploader'>"+TRACKER.images[r].realname+"</a><br/>"+TRACKER.images[r].time+"<br/>"+TRACKER.images[r].latitude+", "+TRACKER.images[r].longitude+'</div><ul class="sf-menu"> <li><a class="infoWinOperations" href="javascript:TRACKER.zoomPoint('+TRACKER.images[r].latitude+","+TRACKER.images[r].longitude+')">'+TRACKER.langOperator.zoom+'</a></li><li><a class="infoWinOperations" href="javascript:TRACKER.zoomMaxPoint('+TRACKER.images[r].latitude+","+TRACKER.images[r].longitude+')">'+TRACKER.langOperator.zoomMax+'</a></li><li><a href="javascript:TRACKER.showCommentWindow(1,1,null)" id="commentsWindow"> Display Comments</a></a></li></li></ul></div>';e.setContentOfInfoWindow(TRACKER.images[r].mapMarker.infoWindow,a),e.openInfoWindow(TRACKER.images[r].mapMarker.infoWindow,TRACKER.images[r].mapMarker.marker),TRACKER.images[r].infoWindowIsOpened=!0,e.setInfoWindowCloseListener(TRACKER.images[r].mapMarker.infoWindow,function(){0==$("#showPhotosOnMap").attr("checked")&&e.setMarkerVisible(TRACKER.images[r].mapMarker.marker,!1)})})})}else e.setMarkerVisible(TRACKER.images[r].mapMarker.marker,TRACKER.showImagesOnTheMap)});for(var t in TRACKER.images)"undefined"!=typeof TRACKER.images[t]&&null!==TRACKER.images[t]&&(e.setMarkerVisible(TRACKER.images[t].mapMarker.marker,TRACKER.showImagesOnTheMap),TRACKER.images[t].infoWindowIsOpened&&0==TRACKER.showImagesOnTheMap&&e.closeInfoWindow(TRACKER.images[t].mapMarker.infoWindow));var R=!1;$.each(i,function(i,a){var r=a.uploadId;"undefined"!=typeof TRACKER.images[r]&&null!==TRACKER.images[r]&&(R=!0,e.setMarkerVisible(TRACKER.images[r].mapMarker.marker,!1),TRACKER.images[r].infoWindowIsOpened&&e.closeInfoWindow(TRACKER.images[r].mapMarker.infoWindow),delete TRACKER.images[r])}),(R===!0||TRACKER.allImagesFetched===!0&&o===!0)&&("undefined"==typeof $.fn.yiiGridView||"undefined"==typeof $.fn.yiiGridView.settings[uploadsGridViewId]||$.fn.yiiGridView.update(uploadsGridViewId))}function processImageXML(e,i){var a="";TRACKER.imageThumbSuffix=decodeURIComponent($(i).find("page").attr("thumbSuffix"));var r=decodeURIComponent($(i).find("page").attr("updateType")),s=new Array,n=!1;$(i).find("page").find("upload").each(function(){var i=$(this),a=$(i).attr("id");s.push(a);var r=decodeURIComponent($(i).attr("url")),o=$(i).attr("byRealName"),t=$(i).attr("byUserId"),R=$(i).attr("latitude"),d=$(i).attr("longitude"),l=$(i).attr("time"),p=$(i).attr("rating"),m="",u=new MapStruct.Location({latitude:R,longitude:d});if(-1==$.inArray(a,TRACKER.imageIds)&&TRACKER.imageIds.push(a),"undefined"==typeof TRACKER.images[a]){n=!0,i=r+"&fileType=0&"+TRACKER.imageThumbSuffix;var f=e.putMarker(u,i,!1,!1),c=e.initializeInfoWindow(),T=new MapStruct.MapMarker({marker:f,infoWindow:c});TRACKER.images[a]=new TRACKER.Img({imageId:a,imageURL:r,userId:t,realname:o,latitude:R,longitude:d,time:l,rating:p,mapMarker:T,description:m}),e.setMarkerVisible(TRACKER.images[a].mapMarker.marker,TRACKER.showImagesOnTheMap),e.setMarkerClickListener(TRACKER.images[a].mapMarker.marker,function(){var i=new Image;i.src=TRACKER.images[a].imageURL+"&fileType=0",$(i).load(function(){var r="<div class='origImageContainer'><div><img src='"+i.src+"' height='"+i.height+"' width='"+i.width+"' class='origImage' /></div><div>"+TRACKER.images[a].description+"<br/><a href='javascript:TRACKER.trackUser("+TRACKER.images[a].userId+")' class='uploader'>"+TRACKER.images[a].realname+"</a><br/>"+TRACKER.images[a].time+"<br/>"+TRACKER.images[a].latitude+", "+TRACKER.images[a].longitude+'</div><ul class="sf-menu"> <li><a class="infoWinOperations" href="javascript:TRACKER.zoomPoint('+TRACKER.images[a].latitude+","+TRACKER.images[a].longitude+')">'+TRACKER.langOperator.zoom+'</a></li><li><a class="infoWinOperations" href="javascript:TRACKER.zoomMaxPoint('+TRACKER.images[a].latitude+","+TRACKER.images[a].longitude+')">'+TRACKER.langOperator.zoomMax+'</a></li><li><a href="javascript:TRACKER.showCommentWindow(1,1,null)" id="commentsWindow"> Display Comments</a></a></li></li></ul></div>';e.setContentOfInfoWindow(TRACKER.images[a].mapMarker.infoWindow,r),e.openInfoWindow(TRACKER.images[a].mapMarker.infoWindow,TRACKER.images[a].mapMarker.marker),TRACKER.images[a].infoWindowIsOpened=!0,e.setInfoWindowCloseListener(TRACKER.images[a].mapMarker.infoWindow,function(){0==$("#showPhotosOnMap").attr("checked")&&e.setMarkerVisible(TRACKER.images[a].mapMarker.marker,!1)})})})}else e.setMarkerVisible(TRACKER.images[a].mapMarker.marker,TRACKER.showImagesOnTheMap)});for(key in TRACKER.images)TRACKER.images.hasOwnProperty(key)&&/^0$|^[1-9]\d*$/.test(key)&&4294967294>=key&&"undefined"!=typeof TRACKER.images[key]&&null!==TRACKER.images[key]&&(e.setMarkerVisible(TRACKER.images[key].mapMarker.marker,TRACKER.showImagesOnTheMap),TRACKER.images[key].infoWindowIsOpened&&0==TRACKER.showImagesOnTheMap&&e.closeInfoWindow(TRACKER.images[key].mapMarker.infoWindow),"all"===r&&-1===s.indexOf(key)&&(e.setMarkerVisible(TRACKER.images[key].mapMarker.marker,!1),TRACKER.images[key].infoWindowIsOpened&&e.closeInfoWindow(TRACKER.images[key].mapMarker.infoWindow),"undefined"==typeof $.fn.yiiGridView||"undefined"==typeof $.fn.yiiGridView.settings[uploadsGridViewId]||$.fn.yiiGridView.update(uploadsGridViewId),delete TRACKER.images[key]));return n===!0&&("undefined"==typeof $.fn.yiiGridView||"undefined"==typeof $.fn.yiiGridView.settings[uploadsGridViewId]||$.fn.yiiGridView.update(uploadsGridViewId)),delete s,a}function getPastPointInfoContent(e,i,a,r,s,n,o,t){var R="";1==r&&(R=TRACKER.langOperator.deviceId+": "+a);var d="<div><b>"+TRACKER.users[e].realname+"</b> "+TRACKER.langOperator.wasHere+"<br/>"+TRACKER.langOperator.time+": "+i+"<br/>"+n+", "+o+R+'</div><ul class="sf-menu"> <li><a class="infoWinOperations" href="javascript:TRACKER.showPointGMarkerInfoWin('+tr+","+s+","+e+')">'+TRACKER.langOperator.previousPoint+"</a></li><li><a href='#' class='infoWinOperations'>"+TRACKER.langOperator.operations+'</a><ul><li><a class="infoWinOperations" href="javascript:TRACKER.zoomPoint('+n+","+o+')">'+TRACKER.langOperator.zoom+'</a></li><li><a class="infoWinOperations" href="javascript:TRACKER.zoomMaxPoint('+n+","+o+')">'+TRACKER.langOperator.zoomMax+'</a></li><li><a class="infoWinOperations" href="javascript:TRACKER.clearTraceLines('+e+')">'+TRACKER.langOperator.clearTraceLines+'</a></li></ul></li><li><a class="infoWinOperations" href="javascript:TRACKER.showPointGMarkerInfoWin('+tr+","+t+","+e+')">'+TRACKER.langOperator.nextPoint+"</a></li></ul>";return d}